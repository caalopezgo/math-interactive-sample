<!DOCTYPE html>
    <html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Great Wave of Kanagawa - Fibonacci Spiral</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1.5rem;
            color: #fff;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 1.5rem;
            max-width: 1200px;
            width: 100%;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 0.5rem;
            font-size: 2rem;
            background: linear-gradient(135deg, #ffd700, #ff8c00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .subtitle {
            text-align: center;
            margin-bottom: 1.5rem;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.95rem;
        }
        
        .canvas-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 0;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
            border: 2px solid rgba(255, 215, 0, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        canvas {
            display: block;
            width: 100%;
            border-radius: 15px;
            cursor: grab;
        }
        
        canvas:active {
            cursor: grabbing;
        }
        
        .action-buttons {
            display: flex;
            gap: 0.8rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
        }
        
        button {
            padding: 0.7rem 1.5rem;
            border: none;
            border-radius: 25px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #ffd700, #ff8c00);
            color: #1a1a2e;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(255, 215, 0, 0.4);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .info-panel {
            background: rgba(255, 215, 0, 0.1);
            padding: 1.5rem;
            border-radius: 12px;
            border-left: 4px solid #ffd700;
        }
        
        .info-panel h4 {
            color: #ffd700;
            margin-bottom: 0.8rem;
            font-size: 1.1rem;
        }
        
        .info-panel p {
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.8;
            margin-bottom: 1rem;
        }
        
        .info-panel p:last-child {
            margin-bottom: 0;
        }
        
        .instruction-box {
            background: rgba(0, 0, 0, 0.3);
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
        }
        
        .instruction-box h5 {
            color: #ffd700;
            margin-bottom: 0.5rem;
        }
        
        .instruction-box ul {
            margin-left: 1.5rem;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .instruction-box li {
            margin: 0.3rem 0;
        }
        
        .hint {
            text-align: center;
            padding: 0.8rem;
            background: rgba(255, 215, 0, 0.1);
            border-radius: 10px;
            margin-bottom: 1rem;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŒŠ The Great Wave of Kanagawa - Fibonacci Spiral</h1>
        <p class="subtitle">Drag the spiral directly to adjust it to the shape of the wave</p>
        
        <div class="hint" id="hint">
            ðŸ’¡ Drag the center to move â€¢ Drag the edge to rotate â€¢ Mouse wheel to scale
        </div>
        
        <div class="canvas-container">
            <canvas id="canvas" width="900" height="600"></canvas>
        </div>
        
        <div class="action-buttons">
            <button class="btn-primary" id="resetBtn">ðŸ”„ Reset</button>
            <button class="btn-secondary" id="autoFitBtn">ðŸŽ¯ Auto-fit</button>
        </div>
        
        <div class="info-panel">
            <h4>ðŸ’¡ The Fibonacci Spiral and Art</h4>
            <p>
                The Fibonacci spiral (also called the golden spiral) appears naturally in many forms in nature: 
                nautilus shells, sunflowers, galaxies, and also in works of art. This spiral is constructed using the 
                Fibonacci sequence (1, 1, 2, 3, 5, 8, 13, 21...), where each number is the sum of the two previous ones.
            </p>
            <p>
                <strong>The Great Wave of Kanagawa</strong> (1831) by Katsushika Hokusai is one of the most famous works of Japanese art. 
                Some studies suggest that the shape of the wave follows proportions that approximate the Fibonacci spiral, 
                which could explain part of its beauty and visual harmony.
            </p>
            <div class="instruction-box">
                <h5>ðŸŽ¯ How to Use</h5>
                <ul>
                    <li><strong>Move:</strong> Click and drag the center of the spiral (golden dot)</li>
                    <li><strong>Rotate:</strong> Click and drag from the outer edge of the spiral</li>
                    <li><strong>Scale:</strong> Use the mouse wheel over the spiral, or drag the scale point (orange circle on the edge)</li>
                    <li>Try to align the spiral with the main shape of the wave</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        class HokusaiFibonacci {
            constructor() {
                this.canvas = document.getElementById('canvas');
                this.ctx = this.canvas.getContext('2d');
                
                this.resizeCanvas();
                window.addEventListener('resize', () => this.resizeCanvas());
                
                // Estado de la espiral
                this.centerX = 0;
                this.centerY = 0;
                this.rotation = 0; // radianes
                this.scale = 1;
                
                // InteracciÃ³n
                this.isDragging = false;
                this.dragType = null; // 'move', 'rotate', 'scale'
                this.dragStart = { x: 0, y: 0 };
                this.dragStartAngle = 0;
                this.dragStartScale = 1;
                
                // Imagen de la ola
                this.waveImage = new Image();
                this.waveImage.crossOrigin = 'anonymous';
                this.waveImage.src = 'https://upload.wikimedia.org/wikipedia/commons/thumb/0/0a/The_Great_Wave_off_Kanagawa.jpg/800px-The_Great_Wave_off_Kanagawa.jpg';
                this.waveImage.onerror = () => {
                    this.waveImage = null;
                };
                
                // Configurar eventos
                this.setupEventListeners();
                
                // Inicializar posiciÃ³n
                this.reset();
                
                // Iniciar animaciÃ³n
                this.animate();
            }
            
            resizeCanvas() {
                const container = this.canvas.parentElement;
                this.canvas.width = container.clientWidth;
                this.canvas.height = 600;
                if (this.centerX === 0 && this.centerY === 0) {
                    this.centerX = this.canvas.width * 0.55;
                    this.centerY = this.canvas.height * 0.4;
                }
            }
            
            setupEventListeners() {
                // Botones
                document.getElementById('resetBtn').addEventListener('click', () => {
                    this.reset();
                });
                
                document.getElementById('autoFitBtn').addEventListener('click', () => {
                    this.autoFit();
                });
                
                // Eventos del canvas
                this.canvas.addEventListener('mousedown', (e) => this.handleMouseDown(e));
                this.canvas.addEventListener('mousemove', (e) => this.handleMouseMove(e));
                this.canvas.addEventListener('mouseup', () => this.handleMouseUp());
                this.canvas.addEventListener('mouseleave', () => this.handleMouseUp());
                this.canvas.addEventListener('wheel', (e) => this.handleWheel(e));
            }
            
            getMousePos(e) {
                const rect = this.canvas.getBoundingClientRect();
                return {
                    x: e.clientX - rect.left,
                    y: e.clientY - rect.top
                };
            }
            
            // Calcular distancia desde el centro de la espiral
            getDistanceFromCenter(x, y) {
                const dx = x - this.centerX;
                const dy = y - this.centerY;
                return Math.sqrt(dx * dx + dy * dy);
            }
            
            // Obtener el radio de la espiral en un Ã¡ngulo dado
            getSpiralRadius(angle) {
                // Espiral de Fibonacci aproximada: r = a * e^(b*Î¸)
                // Usando proporciÃ³n Ã¡urea Ï† â‰ˆ 1.618
                const phi = 1.618;
                const a = 5; // Factor de escala base
                const b = Math.log(phi) / (Math.PI / 2); // Factor de crecimiento
                return a * Math.pow(phi, angle / (Math.PI / 2)) * this.scale;
            }
            
            // Detectar quÃ© parte de la espiral se estÃ¡ tocando
            detectInteraction(x, y) {
                const dist = this.getDistanceFromCenter(x, y);
                const maxRadius = this.getSpiralRadius(Math.PI * 4); // Radio mÃ¡ximo de la espiral
                
                // Punto de escala (en el borde exterior)
                const scaleHandleRadius = maxRadius;
                if (dist > scaleHandleRadius - 20 && dist < scaleHandleRadius + 20) {
                    return 'scale';
                }
                
                // Centro (para mover)
                if (dist < 30) {
                    return 'move';
                }
                
                // Borde (para rotar)
                if (dist > maxRadius - 30 && dist < maxRadius + 30) {
                    return 'rotate';
                }
                
                // Cualquier parte de la espiral (mover)
                if (dist < maxRadius) {
                    return 'move';
                }
                
                return null;
            }
            
            handleMouseDown(e) {
                const pos = this.getMousePos(e);
                this.dragType = this.detectInteraction(pos.x, pos.y);
                
                if (this.dragType) {
                    this.isDragging = true;
                    this.dragStart = pos;
                    this.dragStartAngle = this.rotation;
                    this.dragStartScale = this.scale;
                    
                    // Calcular Ã¡ngulo inicial para rotaciÃ³n
                    const dx = pos.x - this.centerX;
                    const dy = pos.y - this.centerY;
                    this.dragStartAngle = Math.atan2(dy, dx);
                    
                    this.updateCursor();
                }
            }
            
            handleMouseMove(e) {
                const pos = this.getMousePos(e);
                
                if (this.isDragging && this.dragType) {
                    if (this.dragType === 'move') {
                        // Mover la espiral
                        const dx = pos.x - this.dragStart.x;
                        const dy = pos.y - this.dragStart.y;
                        this.centerX += dx;
                        this.centerY += dy;
                        this.dragStart = pos;
                    } else if (this.dragType === 'rotate') {
                        // Rotar la espiral
                        const dx = pos.x - this.centerX;
                        const dy = pos.y - this.centerY;
                        const currentAngle = Math.atan2(dy, dx);
                        const angleDiff = currentAngle - this.dragStartAngle;
                        this.rotation += angleDiff;
                        this.dragStartAngle = currentAngle;
                    } else if (this.dragType === 'scale') {
                        // Escalar la espiral
                        const startDist = Math.sqrt(
                            Math.pow(this.dragStart.x - this.centerX, 2) +
                            Math.pow(this.dragStart.y - this.centerY, 2)
                        );
                        const currentDist = Math.sqrt(
                            Math.pow(pos.x - this.centerX, 2) +
                            Math.pow(pos.y - this.centerY, 2)
                        );
                        const scaleFactor = currentDist / startDist;
                        this.scale = Math.max(0.3, Math.min(3, this.dragStartScale * scaleFactor));
                    }
                } else {
                    // Actualizar cursor segÃºn hover
                    const interaction = this.detectInteraction(pos.x, pos.y);
                    if (interaction === 'move') {
                        this.canvas.style.cursor = 'grab';
                    } else if (interaction === 'rotate') {
                        this.canvas.style.cursor = 'grab';
                    } else if (interaction === 'scale') {
                        this.canvas.style.cursor = 'ns-resize';
                    } else {
                        this.canvas.style.cursor = 'default';
                    }
                }
            }
            
            handleMouseUp() {
                this.isDragging = false;
                this.dragType = null;
                this.canvas.style.cursor = 'grab';
            }
            
            handleWheel(e) {
                e.preventDefault();
                const pos = this.getMousePos(e);
                const dist = this.getDistanceFromCenter(pos.x, pos.y);
                const maxRadius = this.getSpiralRadius(Math.PI * 4);
                
                // Solo escalar si el mouse estÃ¡ sobre la espiral
                if (dist < maxRadius + 50) {
                    const delta = e.deltaY > 0 ? 0.9 : 1.1;
                    this.scale = Math.max(0.3, Math.min(3, this.scale * delta));
                }
            }
            
            updateCursor() {
                if (this.dragType === 'move') {
                    this.canvas.style.cursor = 'grabbing';
                } else if (this.dragType === 'rotate') {
                    this.canvas.style.cursor = 'grabbing';
                } else if (this.dragType === 'scale') {
                    this.canvas.style.cursor = 'ns-resize';
                }
            }
            
            reset() {
                this.centerX = this.canvas.width * 0.5;
                this.centerY = this.canvas.height * 0.5;
                this.rotation = 0;
                this.scale = 1;
            }
            
            autoFit() {
                this.centerX = this.canvas.width * 0.55;
                this.centerY = this.canvas.height * 0.4;
                this.rotation = Math.PI / 4; // 45 grados
                this.scale = 0.8;
            }
            
            drawWaveImage() {
                if (this.waveImage && this.waveImage.complete) {
                    this.ctx.globalAlpha = 0.7;
                    this.ctx.drawImage(this.waveImage, 0, 0, this.canvas.width, this.canvas.height);
                    this.ctx.globalAlpha = 1;
                } else {
                    this.drawSimplifiedWave();
                }
            }
            
            drawSimplifiedWave() {
                const ctx = this.ctx;
                const width = this.canvas.width;
                const height = this.canvas.height;
                
                // Fondo azul
                const gradient = ctx.createLinearGradient(0, 0, 0, height);
                gradient.addColorStop(0, '#1e3c72');
                gradient.addColorStop(1, '#2a5298');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, width, height);
                
                // Ola simplificada
                ctx.fillStyle = '#0f3460';
                ctx.beginPath();
                ctx.moveTo(0, height * 0.6);
                
                for (let x = 0; x < width; x += 5) {
                    const waveX = x / width;
                    const waveY = height * 0.6 + 
                        Math.sin(waveX * Math.PI * 3) * 80 * (1 - waveX * 0.3) +
                        Math.sin(waveX * Math.PI * 8) * 20;
                    ctx.lineTo(x, waveY);
                }
                
                ctx.lineTo(width, height);
                ctx.lineTo(0, height);
                ctx.closePath();
                ctx.fill();
                
                // Espuma blanca
                ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
                ctx.beginPath();
                ctx.moveTo(width * 0.3, height * 0.5);
                ctx.quadraticCurveTo(width * 0.4, height * 0.45, width * 0.5, height * 0.5);
                ctx.quadraticCurveTo(width * 0.6, height * 0.45, width * 0.7, height * 0.5);
                ctx.fill();
            }
            
            drawFibonacciSpiral() {
                const ctx = this.ctx;
                
                ctx.save();
                ctx.translate(this.centerX, this.centerY);
                ctx.rotate(this.rotation);
                
                // Dibujar espiral continua y suave
                ctx.beginPath();
                ctx.strokeStyle = '#ffd700';
                ctx.lineWidth = 4;
                
                const maxAngle = Math.PI * 4; // 2 vueltas completas
                const steps = 200;
                
                for (let i = 0; i <= steps; i++) {
                    const t = i / steps;
                    const angle = t * maxAngle;
                    const radius = this.getSpiralRadius(angle);
                    
                    const x = Math.cos(angle) * radius;
                    const y = Math.sin(angle) * radius;
                    
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                
                ctx.stroke();
                
                // Dibujar punto central
                ctx.beginPath();
                ctx.arc(0, 0, 10, 0, Math.PI * 2);
                ctx.fillStyle = '#ffd700';
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 3;
                ctx.stroke();
                
                // Dibujar punto de escala en el borde
                const maxRadius = this.getSpiralRadius(maxAngle);
                const scaleHandleAngle = maxAngle;
                const scaleHandleX = Math.cos(scaleHandleAngle) * maxRadius;
                const scaleHandleY = Math.sin(scaleHandleAngle) * maxRadius;
                
                ctx.beginPath();
                ctx.arc(scaleHandleX, scaleHandleY, 12, 0, Math.PI * 2);
                ctx.fillStyle = '#ff8c00';
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                ctx.restore();
            }
            
            draw() {
                const ctx = this.ctx;
                
                // Limpiar canvas
                ctx.fillStyle = '#1a1a2e';
                ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Dibujar imagen de la ola
                this.drawWaveImage();
                
                // Dibujar espiral de Fibonacci
                this.drawFibonacciSpiral();
            }
            
            animate() {
                this.draw();
                requestAnimationFrame(() => this.animate());
            }
        }
        
        // Inicializar cuando se carga la pÃ¡gina
        window.addEventListener('DOMContentLoaded', () => {
            new HokusaiFibonacci();
        });
    </script>
</body>
</html>
